<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Frontpage (Dynamic)</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>

<div class="nav-bar">
    <ul class="nav-panel">
        <li><a href="loginPage.html">Create account</a></li>
        <form class="login">
            <label for="username"></label>
            <input class ="js_username" type="text" name="username" placeholder="username">

            <label for ="password"> </label>
            <input class="js_password" name="password" type="password" placeholder="password">
            <button> submit </button>
        </form>
    </ul>
</div>

<div class="create-blog-post">
    <button type="submit" class="btn"><span class="plus-sign">&#43;</span></button>
    <div class="popup" id="popup">
        <div class="close-btn">&times;</div>
        <form class="createblogpost">
            <div class="add_subject">
                <label for="subject"></label>
                <input class="js_subject" type="text" name="subject" id="form_subject" placeholder="Add subject">
            </div>

            <div class ="add_body">
                <label for ="body"></label>
                <textarea class = `.js_body` id="body" name="body" rows="30" cols="50"></textarea>
            </div>

            <div class="add_category">
                <label for="category"></label>
                <input class="js_category" type="text" name="category" id="form_category" placeholder="Add category">
            </div>

            <button type="submit" class="submit-btn" onclick="
    submitForm()"
            >Create blog post</button>
        </form>
    </div>
</div>

<!-- Blog posts will be rendered here -->
<div id="blog-posts-container"></div>

<script>
    const url = 'http://localhost:8080/api/v1/blog/getallblogpost';
    const container = document.getElementById('blog-posts-container');
    var date = new Date().toISOString().slice(0,10);

    function createBlogBox(blog) {
        return `
    <div class="blog-section">
        <div class="blog-box">
            <div class="blog-userInfo-logo">
                <img src="${blog.userInfo?.imgPath || 'default.jpeg'}">
                <p>${blog.userInfo?.name || 'Unknown'}</p>
            </div>
            <div class="blog-post-subject">
                <h2>${blog.subject}</h2>
                <p>${blog.publishDate}</p>
            </div>
            <div class="blog-post-body">
                <p>${blog.body}</p>
            </div>
            <div class="blog-interaction">
                <div class="blog-likes-section">
                    <ul>
                        <li><a href="#" class="interaction">like</a></li>
                        <li><a href="#" class="interaction">comment</a></li>
                        <li><a href="#" class="interaction">share</a></li>
                    </ul>
                </div>
                <div class="blog-see-all-comments">
                    <p>this is a comment</p>
                    <p>this is a comment</p>
                    <p>this is a comment</p>
                </div>
                <div class="blog-add-comments">
                    <label>
                        <input type="text" placeholder="Add a comment here">
                    </label>
                </div>
            </div>
        </div>
    </div>
    `;
    }

    fetch(url)
        .then(res => res.json())
        .then(data => {
            container.innerHTML = data.map(createBlogBox).join('');
        })
        .catch(err => {
            container.innerHTML = '<p>Failed to load blog posts.</p>';
            console.error(err);
        });

    document.querySelector(".btn").addEventListener("click", function(){
        document.querySelector(".popup").classList.add("active");
    });
    document.querySelector(".popup .close-btn").addEventListener("click", function(){
        document.querySelector(".popup").classList.remove("active");
    });


    function submitForm() {


        const formEl = document.querySelector('.createblogpost');

        formEl.addEventListener('submit', event => {
            event.preventDefault();

            const formData = new FormData(formEl);
            formData.set('publishDate', date);
            const data = Object.fromEntries(formData);

            fetch('http://localhost:8080/api/blog/saveblogpost', {
                method: 'POST',
                headers: {
                    'Content-type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(res => res.json())
                .then(data => console.log(data))
                .catch(error => console.log(error))
        });
        alert("Blog post created")
    };





</script>

</body>
</html>
